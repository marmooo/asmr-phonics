let problems=[],problem=["ASMR","Phonics"],paused=!1,englishVoices=[],japaneseVoices=[];loadConfig();function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function loadVoices(){const e=new Promise(e=>{let t=speechSynthesis.getVoices();if(t.length!==0)e(t);else{let n=!1;speechSynthesis.addEventListener("voiceschanged",()=>{n=!0,t=speechSynthesis.getVoices(),e(t)}),setTimeout(()=>{n||document.getElementById("noTTS").classList.remove("d-none")},1e3)}}),t=["com.apple.speech.synthesis.voice.Bahh","com.apple.speech.synthesis.voice.Albert","com.apple.speech.synthesis.voice.Hysterical","com.apple.speech.synthesis.voice.Organ","com.apple.speech.synthesis.voice.Cellos","com.apple.speech.synthesis.voice.Zarvox","com.apple.speech.synthesis.voice.Bells","com.apple.speech.synthesis.voice.Trinoids","com.apple.speech.synthesis.voice.Boing","com.apple.speech.synthesis.voice.Whisper","com.apple.speech.synthesis.voice.Deranged","com.apple.speech.synthesis.voice.GoodNews","com.apple.speech.synthesis.voice.BadNews","com.apple.speech.synthesis.voice.Bubbles"];e.then(e=>{englishVoices=e.filter(e=>e.lang=="en-US").filter(e=>!t.includes(e.voiceURI)),japaneseVoices=e.filter(e=>e.lang=="ja-JP")})}loadVoices();function speak(e,t){speechSynthesis.cancel();const n=new SpeechSynthesisUtterance(e);return t=="en-US"?(n.voice=englishVoices[Math.floor(Math.random()*englishVoices.length)],n.lang="en-US"):(n.voice=japaneseVoices[Math.floor(Math.random()*japaneseVoices.length)],n.lang="ja-JP"),speechSynthesis.speak(n),n}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}function initProblems(){const e=document.getElementById("gradeOption").radio.value;fetch("data/"+e+".csv").then(e=>e.text()).then(e=>{problems=[],e.trim().split(`
`).forEach(e=>{const[t,n]=e.split(",");problems.push([t,n])})})}initProblems();function respeak(){paused=!0,document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none"),speechSynthesis.cancel();const[e,n]=problem;let t=e;for(let n=0;n<2;n++)t+=", "+e;const s=speak(t,"en-US");s.onend=()=>{if(paused){const e=speak(n,"ja-JP");e.onend=()=>{paused&&respeak()}}},/(iPad|iPhone|iPod|Macintosh)/.test(navigator.userAgent)&&setTimeout(()=>{document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none")},2e3)}function startASMR(){paused=!1,document.getElementById("startButton").classList.add("d-none"),document.getElementById("stopButton").classList.remove("d-none"),speechSynthesis.cancel(),problem=problems[getRandomInt(0,problems.length)];const[e,t]=problem,n=e.split("").join("-")+" is, "+e,s=speak(n,"en-US");s.onend=()=>{if(!paused){const e=speak(t,"ja-JP");e.onend=()=>{paused||startASMR()}}}}function stopASMR(){paused=!0,document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none"),speechSynthesis.cancel()}function speakAnswer(){speak(problem[1],"ja-JP")}document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("startButton").onclick=startASMR,document.getElementById("stopButton").onclick=stopASMR,document.getElementById("respeak").onclick=respeak,document.getElementById("answer").onclick=speakAnswer,document.getElementById("gradeOption").onchange=initProblems