let paused=!1,problem=["ASMR","Phonics"],englishVoices=[],japaneseVoices=[];loadConfig();function loadConfig(){localStorage.getItem("darkMode")==1&&(document.documentElement.dataset.theme="dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),delete document.documentElement.dataset.theme):(localStorage.setItem("darkMode",1),document.documentElement.dataset.theme="dark")}function loadVoices(){const a=new Promise(function(b){let a=speechSynthesis.getVoices();if(a.length!==0)b(a);else{let c=!1;speechSynthesis.addEventListener("voiceschanged",function(){c=!0,a=speechSynthesis.getVoices(),b(a)}),setTimeout(()=>{c||document.getElementById("noTTS").classList.remove("d-none")},1e3)}});a.then(a=>{englishVoices=a.filter(a=>a.lang=="en-US"),japaneseVoices=a.filter(a=>a.lang=="ja-JP")})}loadVoices();function speak(b,c){speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(b);return c=="en-US"?(a.voice=englishVoices[Math.floor(Math.random()*englishVoices.length)],a.lang="en-US"):(a.voice=japaneseVoices[Math.floor(Math.random()*japaneseVoices.length)],a.lang="ja-JP"),speechSynthesis.speak(a),a}function getRandomInt(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a)+a)}function initProblems(){const a=document.getElementById("gradeOption").radio.value;fetch("data/"+a+".csv").then(a=>a.text()).then(a=>{problems=[],a.trim().split("\n").forEach(a=>{const[b,c]=a.split(",");problems.push([b,c])})})}initProblems();function respeak(){paused=!0,document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none"),speechSynthesis.cancel();let a=problem[0];for(let b=0;b<2;b++)a+=", "+problem[0];const b=speak(a,"en-US");b.onend=function(){if(paused){const a=speak(problem[1],"ja-JP");a.onend=()=>{paused&&respeak()}}},/(iPad|iPhone|iPod|Macintosh)/.test(navigator.userAgent)&&setTimeout(()=>{document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none")},2e3)}function startASMR(){paused=!1,document.getElementById("startButton").classList.add("d-none"),document.getElementById("stopButton").classList.remove("d-none"),speechSynthesis.cancel(),problem=problems[getRandomInt(0,problems.length)];const a=problem[0].split("").join("-")+" is, "+problem[0],b=speak(a,"en-US");b.onend=function(){if(!paused){const a=speak(problem[1],"ja-JP");a.onend=()=>{paused||startASMR()}}}}function stopASMR(){paused=!0,document.getElementById("startButton").classList.remove("d-none"),document.getElementById("stopButton").classList.add("d-none"),speechSynthesis.cancel()}function speakAnswer(){speak(problem[1],"ja-JP")}document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("startButton").onclick=startASMR,document.getElementById("stopButton").onclick=stopASMR,document.getElementById("respeak").onclick=respeak,document.getElementById("answer").onclick=speakAnswer,document.getElementById("gradeOption").onchange=initProblems